# 2weekコンタクト管理 PWA（Google Apps Script）

2週間使い捨てコンタクトの開始日を登録すると、交換日を計算して表示し、Googleカレンダーに自動で予定を作成する PWA です。オフラインでも交換日を確認できます。

## 機能
- 開始日を入力すると、14日後の交換日を計算
- 残り日数/超過日数をバッジ表示
- Googleカレンダーに全日イベントを自動作成（既存イベントがあれば置き換え）
- PWA 対応（ホーム画面追加・オフライン閲覧）
- 設定画面を分離（開始日入力は `/settings` で実行）

## ファイル構成（主要）
- `Code.js` : doGet ルーティング、状態保存、カレンダー登録
- `index.html` : 画面本体
- `styles.html` : スタイル
- `client.html` : フロントエンドロジック
- `sw.html` : Service Worker
- `appsscript.json` : スクリプト設定（Calendar スコープ含む）

## 前提
- Google アカウント（デフォルトカレンダーを使用）
- clasp セットアップ済み（`clasp login` 済み）

## デプロイ手順
1. 必要ならタイムゾーンや日数を変更  
   - 交換周期: `Code.js` の `LENS_DURATION_DAYS`（デフォルト 14 日）  
   - タイムゾーン: `appsscript.json` の `timeZone`（デフォルト Asia/Tokyo）
2. スクリプトをアップロード  
   ```bash
   clasp push
   ```
3. Apps Script エディタで「デプロイ」→「新しいデプロイ」→「種類: ウェブアプリ」を選択  
   - 実行するユーザー: 自分  
   - アクセスできるユーザー: リンクを知っている全員（用途に合わせて変更可）
4. 初回アクセス時に表示される認可ダイアログで Google カレンダーアクセスを許可。

## 使い方
1. ウェブアプリの URL にアクセスすると、交換日と残り日数を確認できます。
2. 開始日を登録・変更する場合は `.../exec?view=settings`（または「設定を開く」ボタン）から設定画面へ。  
   - 「レンズを装着した日」を選択して「保存する」を押すと、交換日を再計算しカレンダーに登録します。
3. ブラウザの「ホーム画面に追加」から PWA としてインストールすると、オフラインでも確認できます。

## メモ
- 交換イベントは最新の開始日で常に置き換えます（古いイベントが残らないように削除してから再作成）。
- `CalendarApp` のデフォルトカレンダーを使用します。別カレンダーを使いたい場合は `upsertCalendarEvent` を適宜修正してください。
- 変更後は `clasp push` を忘れずに。***
